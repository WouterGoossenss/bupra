---
title: "Project BUPRA"
author: "Wouter Goossens, Daan Roosen"
date: "22-11-2017"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(bupaR)
library(lubridate)
library(dplyr)
library(tidyr)
library(stringr)
library(ggplot2)
library(readr)
data <- read_delim("data.csv", 
    ";", escape_double = FALSE, trim_ws = TRUE)
<<<<<<< HEAD
=======
<<<<<<< HEAD
>>>>>>> 0fe36ca9c11ca74ba6bbad1c71f69cea66e5c6f9
```

```{r}
data <- data %>%
  mutate(Timestamp = ymd_hms(substr(`Complete Timestamp`, 1, nchar(`Complete Timestamp`) - 4))) %>%
  mutate(activity_instance_id = row_number()) %>%
  mutate(case_id = `Case ID`) %>% select(-`Case ID`)
```

```{r}
log <- data %>%
  eventlog(
    case_id = "case_id",
    activity_id = "Activity",
    activity_instance_id = "activity_instance_id",
    lifecycle_id = "lifecycle:transition",
    timestamp = "Timestamp",
    resource_id = "Resource"
  )
```

## Beschrijving data

Aantal cases:

```{r}
log %>%
  n_cases()
```

Aantal events:

```{r}
log %>%
  n_events()
```

Aantal resources:

```{r}
log %>%
  n_resources()
```

Activiteiten:

```{r}
log %>%
  activities()
```

Resources:

```{r}
log %>%
  resources()
```

Structuur van de traces in de eventlog:

```{r}
log %>%
  trace_coverage("trace") %>%
  plot
```

Startactiviteiten:

```{r}
log %>%
  start_activities("activity")
```

Eindactiviteiten:

```{r}
log %>%
  end_activities("activity")
```

Activiteiten die opnieuw worden gedaan door dezelfde persoon:

```{r}
log %>% number_of_repetitions(type = "repeat", "activity") %>%
	arrange(-relative)
```


Activiteiten die opnieuw worden gedaan maar door een andere persoon:

```{r}
log %>% number_of_repetitions(type = "redo", "activity") %>%
	arrange(-relative)
```

Throughput time:

```{r}
log %>%
  throughput_time()
```

```{r}
log %>%
  throughput_time() %>%
  plot
```

Verdeling van het aantal cases per dag:

```{r}
log %>%
	mutate(day_of_week = wday(Timestamp, label = T)) %>%
	ggplot(aes(day_of_week)) +
	geom_bar()
```

Welke belangrijke resources zijn aanwezig in iedere case:

```{r}
log %>%
	filter_resource_frequency(perc = 0.85) %>%
  resource_involvement("resource")
```

```{r}
log %>%
	filter_resource_frequency(perc = 0.9) %>%
  resource_map()
```

<<<<<<< HEAD

=======

## Onderzoeksvragen



=======
```
>>>>>>> 0fe36ca9c11ca74ba6bbad1c71f69cea66e5c6f9

```{r}
data <- data %>%
  mutate(Timestamp = ymd_hms(substr(`Complete Timestamp`, 1, nchar(`Complete Timestamp`) - 4))) %>%
  mutate(activity_instance_id = row_number()) %>%
  mutate(case_id = `Case ID`) %>% select(-`Case ID`)
```

```{r}
log <- data %>%
  eventlog(
    case_id = "case_id",
    activity_id = "Activity",
    activity_instance_id = "activity_instance_id",
    lifecycle_id = "lifecycle:transition",
    timestamp = "Timestamp",
    resource_id = "Resource"
  )
```

## Beschrijving data

Aantal cases:

```{r}
log %>%
  n_cases()
```

Aantal events:

```{r}
log %>%
  n_events()
```

Aantal resources:

```{r}
log %>%
  n_resources()
```

Activiteiten:

```{r}
log %>%
  activities()
```

Resources:

```{r}
log %>%
  resources()
```

Structuur van de traces in de eventlog:

```{r}
log %>%
  trace_coverage("trace") %>%
  plot
```

Startactiviteiten:

```{r}
log %>%
  start_activities("activity")
```

Eindactiviteiten:

```{r}
log %>%
  end_activities("activity")
```

Activiteiten die opnieuw worden gedaan door dezelfde persoon:

```{r}
log %>% number_of_repetitions(type = "repeat", "activity") %>%
	arrange(-relative)
```


Activiteiten die opnieuw worden gedaan maar door een andere persoon:

```{r}
log %>% number_of_repetitions(type = "redo", "activity") %>%
	arrange(-relative)
```

Throughput time:

```{r}
log %>%
  throughput_time()
```

```{r}
log %>%
  throughput_time() %>%
  plot
```

Verdeling van het aantal cases per dag:

```{r}
log %>%
	mutate(day_of_week = wday(Timestamp, label = T)) %>%
	ggplot(aes(day_of_week)) +
	geom_bar()
```

Welke belangrijke resources zijn aanwezig in iedere case:

```{r}
log %>%
	filter_resource_frequency(perc = 0.85) %>%
  resource_involvement("resource")
```

```{r}
log %>%
	filter_resource_frequency(perc = 0.9) %>%
  resource_map()
```

##Managementsamenvatting
<<<<<<< HEAD

##Inhoudstafel

##Inleiding

Lifecycle:transaction -> nutteloos attribuut (altijd 'complete')

Variant index -> identifier van de trace

##Resultaten

1. Hoeveel facturen worden uiteindelijk niet betaald?

```{r}
log %>%
  group_by(case_id) %>%
  summarise(
    last_activity = last(Activity)
  ) %>%
  filter(last_activity != "BILLED")

```

2. Welke activiteiten moeten vaak opnieuw worden uitgevoerd?

3. Hoe lang duren de verschillende activiteiten?

4. Wat zorgt ervoor dat cases langer duren?

=======

##Inhoudstafel

##Inleiding

Lifecycle:transaction -> nutteloos attribuut (altijd 'complete')

Variant index -> identifier van de trace

##Resultaten

1. Hoeveel van de betalingen worden niet correct uitgevoerd?

2. Welke activiteiten moeten vaak opnieuw worden uitgevoerd?

3. Hoe lang duren de verschillende activiteiten?

4. Wat zorgt ervoor dat cases langer duren?

>>>>>>> 0fe36ca9c11ca74ba6bbad1c71f69cea66e5c6f9
5. Welke diagnose duurt het langst om vast te stellen? (gepikt van Quinten & Leen)

6. Welke traces eindigen vaak geblokkeerd?

<<<<<<< HEAD
7. Welke diagnose wordt later het vaakst veranderd?

```{r}
log %>%
  filter(!is.na(diagnosis)) %>%
  group_by(case_id) %>%
  summarise(
    n = n()
  ) %>%
  filter(n > 1) %>%
  left_join(
    log %>%
      select(case_id, diagnosis, activity_instance_id, Activity) %>%
      filter(!is.na(diagnosis))
  ) %>%
  filter(Activity == "CHANGE DIAGN") %>%
  mutate(wrong_diagnosis = ifelse(case_id == lead(case_id), T, F)) %>%
  filter(wrong_diagnosis == T) %>%
  select(diagnosis, wrong_diagnosis) %>%
  group_by(diagnosis, wrong_diagnosis) %>%
  summarise(
    frequency = n()
  ) %>%
  arrange(-frequency) %>%
  select(-wrong_diagnosis)
```

8. Welke eerste diagnose was vaak toch de juiste?

9. Welke diagnoses volgen mekaar vaak op?

```{r}
log %>%
  filter(!is.na(diagnosis)) %>%
  group_by(case_id) %>%
  summarise(
    n = n()
  ) %>%
  filter(n > 1) %>%
  left_join(
    log %>%
      select(case_id, diagnosis, activity_instance_id, Activity) %>%
      filter(!is.na(diagnosis))
  ) %>%
  arrange(-n, case_id, activity_instance_id) %>%
  filter(Activity == "CHANGE DIAGN") %>%
  mutate(previous_diagnosis = ifelse(case_id == lag(case_id), lag(diagnosis), NA)) %>%
  select(previous_diagnosis, diagnosis, case_id) %>%
  filter(!is.na(previous_diagnosis)) %>%
  group_by(previous_diagnosis, diagnosis) %>%
  summarise(
    frequency = n()
  ) %>%
  arrange(-frequency)
```

10. Hoe vaak zijn dokters het niet helemaal eens over de diagnose?

11. Hoevaak wordt een eerst afgewezen diagnose, toch opnieuw gesteld?

##Beperkingen

##Conclusie
=======
##Beperkingen

##Conclusie
>>>>>>> becff12f1a0d8bec07a77050c95d3f3aaa8b266b
>>>>>>> 0fe36ca9c11ca74ba6bbad1c71f69cea66e5c6f9




















